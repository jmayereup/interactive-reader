<!-- reader-template.html (No Tailwind Dependency) -->
<style>
    /* * Pre-compiled styles inspired by TailwindCSS for a modern look.
     * This removes the need for the external Tailwind CDN script.
     */

    /* Basic styles for the component host and theme variables */
    :host {
        display: block;
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        --background-light: #ffffff;
        --text-light: #334155;
        --muted-light: #64748b;
        --card-background-light: #f8fafc; /* Slightly off-white for cards */
        --border-light: #e2e8f0;
        --primary-light: #3b82f6;
        --primary-hover-light: #2563eb;
        --secondary-light: #10b981;
        --secondary-hover-light: #059669;
        --highlight-light: #fef08a;
        --word-in-list-bg-light: #dcfce7;
        --word-in-list-text-light: #166534;
        --danger-light: #ef4444;
        --danger-hover-light: #dc2626;


        --background-dark: #111827;
        --text-dark: #d1d5db;
        --muted-dark: #9ca3af;
        --card-background-dark: #1f2937;
        --border-dark: #374151;
        --primary-dark: #60a5fa;
        --primary-hover-dark: #3b82f6;
        --secondary-dark: #34d399;
        --secondary-hover-dark: #10b981;
        --highlight-dark: #facc15;
        --word-in-list-bg-dark: #14532d;
        --word-in-list-text-dark: #bbf7d0;
        --danger-dark: #f87171;
        --danger-hover-dark: #ef4444;

        /* Default to light mode variables */
        --bg: var(--background-light);
        --text-color: var(--text-light);
        --text-muted: var(--muted-light);
        --card-bg: var(--card-background-light);
        --border-color: var(--border-light);
        --primary: var(--primary-light);
        --primary-hover: var(--primary-hover-light);
        --secondary: var(--secondary-light);
        --secondary-hover: var(--secondary-hover-light);
        --danger: var(--danger-light);
        --danger-hover: var(--danger-hover-light);
        --highlight-bg: var(--highlight-light);
        --word-in-list-bg: var(--word-in-list-bg-light);
        --word-in-list-text: var(--word-in-list-text-light);
    }

    /* Apply dark mode variables when the .dark class is present */
    :host(.dark) {
        --bg: var(--background-dark);
        --text-color: var(--text-dark);
        --text-muted: var(--muted-dark);
        --card-bg: var(--card-background-dark);
        --border-color: var(--border-dark);
        --primary: var(--primary-dark);
        --primary-hover: var(--primary-hover-dark);
        --secondary: var(--secondary-dark);
        --secondary-hover: var(--secondary-hover-dark);
        --danger: var(--danger-dark);
        --danger-hover: var(--danger-hover-dark);
        --highlight-bg: var(--highlight-dark);
        --word-in-list-bg: var(--word-in-list-bg-dark);
        --word-in-list-text: var(--word-in-list-text-dark);
    }

    /* General component styling */
    .container-wrapper {
        background-color: var(--bg);
        color: var(--text-color);
        padding: 1rem;
        transition: background-color 0.3s, color 0.3s;
    }
    .card {
        background-color: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 0.5rem; /* rounded-lg */
        padding: 1.5rem; /* p-6 */
        transition: background-color 0.3s, border-color 0.3s;
    }
    .prose p {
        line-height: 170%;
        font-size: 100%;
        color: var(--text-color);
    }
    .clickable-word {
        cursor: pointer;
        transition: background-color 0.2s, color 0.2s;
        border-radius: 4px;
        padding: 2px 3px;
        margin: -2px -3px;
    }
    .clickable-word:hover {
        background-color: var(--primary);
        color: white;
    }
    .word-in-list {
        background-color: var(--word-in-list-bg);
        color: var(--word-in-list-text);
        font-weight: 600;
    }
    .speaking-highlight {
        background-color: var(--highlight-bg);
        color: #1f2937;
    }
    .word-list-item {
        background-color: var(--bg);
        border: 1px solid var(--border-color);
        padding: 0 0.75rem;
        border-radius: 0.375rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: pointer;
        transition: border-color 0.2s;
        line-height: 80%; /* Reduced line height */
    }
    .word-list-item:hover {
        border-color: var(--primary);
    }
    .spaced-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .button {
        font-weight: 700;
        font-size: 85%;
        padding: 0.5rem 1rem;
        border-radius: 0.5rem; /* rounded-lg */
        transition: background-color 0.2s, opacity 0.2s;
        width: 100%;
        color: white;
        border: none;
        cursor: pointer;
        margin-bottom: .25rem; /* mb-2 */
    }
    .button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
    .button-primary { background-color: var(--primary); }
    .button-primary:hover:not(:disabled) { background-color: var(--primary-hover); }
    .button-secondary { background-color: var(--secondary); }
    .button-secondary:hover:not(:disabled) { background-color: var(--secondary-hover); }
    .button-red { background-color: var(--danger); }
    .button-red:hover:not(:disabled) { background-color: var(--danger-hover); }
    .button-slate { background-color: #64748b; }
    .button-slate:hover:not(:disabled) { background-color: #52525b; }

    /* Layout & Structure */
    #main-content {
        max-width: 72rem; /* max-w-6xl */
        margin-left: auto;
        margin-right: auto;
    }
    header {
        text-align: center;
        margin-bottom: 2rem; /* mb-8 */
    }
    main {
        display: grid;
        grid-template-columns: 1fr;
        gap: 2rem; /* gap-8 */
    }
    .lg-grid-cols-3 {
        grid-template-columns: repeat(3, minmax(0, 1fr));
    }
    .lg-col-span-2 {
        grid-column: span 2 / span 2;
    }
    .lg-col-span-1 {
        grid-column: span 1 / span 1;
    }
    .flex { display: flex; }
    .flex-col { flex-direction: column; }
    .flex-grow { flex-grow: 1; }
    .justify-center { justify-content: center; }
    .items-center { align-items: center; }
    .justify-between { justify-content: space-between; }
    
    /* Spacing & Sizing */
    .gap-3 { gap: 0.75rem; }
    .gap-4 { gap: 1rem; }
    .space-y-2 > :not([hidden]) ~ :not([hidden]) { margin-top: 0.25rem; }
    .w-full { width: 100%; }
    .h-full { height: 100%; }
    .max-h-45vh { max-height: 45vh; }
    .max-h-70vh { max-height: 70vh; }
    .overflow-y-auto { overflow-y: auto; }
    .pr-2 { padding-right: 0.5rem; }
    .mt-4 { margin-top: 1rem; }
    .pt-6 { padding-top: 1.5rem; }
    .mb-1 { margin-bottom: 0.25rem; }
    .mb-4 { margin-bottom: 1rem; }
    .mb-6 { margin-bottom: 1.5rem; }
    .p-2 { padding: 0.5rem; }
    .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
    .px-4 { padding-left: 1rem; padding-right: 1rem; }
    
    /* Typography */
    .main-title {
        font-size: 180%; /* text-3xl */
        font-weight: 700; /* font-bold */
        color: var(--text-color);
    }
    .text-xl { font-size: 125%; }
    .text-3xl { font-size: 185%; }
    .text-4xl { font-size: 225%; }
    .font-bold { font-weight: 700; }
    .font-light { font-weight: 300; }
    .font-medium { font-weight: 500; }
    .text-sm { font-size: 85%; }
    .text-center { text-align: center; }

    /* Controls & Icons */
    .control-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 9999px; /* rounded-full */
        transition: background-color 0.2s;
        border: none;
        cursor: pointer;
        width: 3rem;
        height: 3rem;
    ;
    }
    #listen-btn { width: 3.5rem; height: 3.5rem; } 
    #pause-btn, #slow-btn { width: 3.5rem; height: 3.5rem; } 
    .control-btn { background-color: #e5e7eb; }
    .control-btn:hover { background-color: #d1d5db; }
    :host(.dark) .control-btn { background-color: #374151; }
    :host(.dark) .control-btn:hover { background-color: #4b5569; }
    .control-btn svg { color: #1f2937; }
    :host(.dark) .control-btn svg { color: #d1d5db; }
    #listen-btn svg { width: 2.5rem; height: 2.5rem; } /* w-8, h-8 */
    #pause-btn svg { width: 2.5rem; height: 2.5rem; } /* w-6, h-6 */
    #slow-btn svg { width: 2.5rem; height: 2.5rem; } /* w-7, h-7 */
    #export-btn svg { width: 1rem; height: 1rem; }

    /* Theme Toggle */
    #theme-toggle-btn {
        border-radius: 9999px; /* rounded-full */
        background-color: var(--card-bg);
        color: var(--text-muted);
        border: 1px solid var(--border-color);
        padding: 0.5rem; /* p-2 */
    }
    #theme-toggle-btn:focus {
        outline: 2px solid transparent;
        outline-offset: 2px;
        box-shadow: 0 0 0 2px var(--primary);
    }
    #theme-toggle-btn svg {
        width: 1.5rem; /* h-6, w-6 */
        height: 1.5rem;
    }

    #thai-word-input {
        font-family: 'Sarabun', sans-serif;
        width: 211px;;
        margin-bottom: 0.5rem;
        font-size: 100%;;
    }

    /* Modals & Popups */
    .hidden { display: none; }
    .fixed { position: fixed; }
    .inset-0 { top: 0; right: 0; bottom: 0; left: 0; }
    .z-40 { z-index: 40; }
    .z-50 { z-index: 50; }
    #translation-popup {
        min-width: 220px;
        padding: 1rem;
        gap: 0.5rem; 
        box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1); /* shadow-xl */
    }
    #activity-modal { background-color: var(--bg); }
    #activity-content {
        background-color: var(--card-bg);
        border: 1px solid var(--border-color);
        flex-grow: 1;
        border-radius: 0.5rem; /* rounded-lg */
        padding: 1.5rem; /* p-6 */
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }
    #word-count-selector select {
        width: 100%;
        padding: 0.5rem;
        border-radius: 0.375rem; /* rounded-md */
        border: 1px solid var(--border-color);
        background-color: var(--bg);
        color: var(--text-color);
    }

    /* Activity Specific Styles */
    @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }

    /* Quiz Styles */
    .quiz-container {
        width: 100%;
        max-width: 600px;
        text-align: center;
    }
    .quiz-question {
        font-size: 225%;
        font-weight: 700;
        margin: 1.5rem 0;
        color: var(--text-color);
    }
    .quiz-options-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
    }
    .quiz-option {
        background-color: var(--bg);
        border: 1px solid var(--border-color);
        color: var(--text-color);
        padding: 1.5rem;
        border-radius: 0.5rem;
        font-size: 110%;
        cursor: pointer;
        transition: all 0.2s;
        font-family: 'Sarabun', sans-serif;
    }
    .quiz-option:hover:not(:disabled) {
        border-color: var(--primary);
        transform: translateY(-2px);
        box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
    }
    .quiz-option:disabled { cursor: not-allowed; }
    .quiz-option.correct { background-color: var(--secondary); color: white; border-color: var(--secondary-hover); }
    .quiz-option.incorrect { background-color: var(--danger); color: white; border-color: var(--danger-hover); }
    .quiz-feedback {
        margin-top: 1.5rem;
        height: 3rem;
    }

    /* Matching Game (Memory) Styles */
    .memory-grid {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 1rem;
        width: 100%;
        max-width: 800px;
        perspective: 1000px; /* For 3D flip effect */
    }
    .memory-card {
        flex: 0 0 120px; /* Set a fixed base size for the cards */
        height: 150px;
        background-color: transparent;
        border-radius: 0.5rem;
        cursor: pointer;
        position: relative;
        transform-style: preserve-3d;
        transition: transform 0.6s;
    }
    .memory-card.flipped, .memory-card.matched {
        transform: rotateY(180deg);
    }
    .card-face {
        position: absolute;
        width: 100%;
        height: 100%;
        -webkit-backface-visibility: hidden;
        backface-visibility: hidden;
        border-radius: 0.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        font-size: 125%;
        font-weight: 600;
        border: 1px solid var(--border-color);
        box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
    }
    .card-front {
        background: var(--card-bg);
        color: var(--primary);
    }
    .card-front-icon {
        width: 50%;
        height: 50%;
        opacity: 0.5;
    }
    .card-back {
        background-color: var(--bg);
        color: var(--text-color);
        transform: rotateY(180deg);
    }
    .card-back.thai {
        font-family: 'Sarabun', sans-serif;
    }
    .memory-card.matched .card-back {
        background-color: var(--secondary);
        color: white;
        border-color: var(--secondary-hover);
    }
    .memory-card.mismatched {
        animation: shake 0.5s;
    }
    .memory-card.mismatched .card-back {
        background-color: #fee2e2;
        border-color: var(--danger);
    }
    :host(.dark) .memory-card.mismatched .card-back {
        background-color: #5d2b2b;
        border-color: var(--danger-dark);
    }


    .remove-word-btn { background: none; border: none; color: var(--danger); font-size: 125%; cursor: pointer; padding: 0; }
    .remove-word-btn:hover { color: var(--danger-hover); }
    .remove-word-btn svg { width: 1.25rem; height: 1.25rem; }
    .sidebar-title { padding-left: 1rem; }

    /* Responsive Styles */
    @media (min-width: 768px) { /* md: */
        .container-wrapper { padding: 2rem; }
        .card { padding: 2rem; }
        .main-title { font-size: 300%; } /* md:text-5xl */
    }
    @media (min-width: 1024px) { /* lg: */
        main { grid-template-columns: repeat(3, minmax(0, 1fr)); }
        .lg-col-span-2 { grid-column: span 2 / span 2; }
        .lg-col-span-1 { grid-column: span 1 / span 1; }
    }
</style>

<div class="container-wrapper">
    <div id="main-content">
        <header>
            <div class="flex justify-center items-center mb-4 gap-4">
                 <h1 class="main-title"></h1>
                 <button id="theme-toggle-btn">
                    <svg id="theme-icon-sun" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" /></svg>
                    <svg id="theme-icon-moon" xmlns="http://www.w3.org/2000/svg" class="hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>
                </button>
            </div>
            <div class="tts-controls flex justify-center items-center gap-3">
                <button id="listen-btn" class="control-btn" title="Listen to Text">
                    <svg id="listen-icon-play" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"></path></svg>
                    <svg id="listen-icon-stop" class="hidden" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1V8a1 1 0 00-1-1H8z" clip-rule="evenodd"></path></svg>
                </button>
                <button id="pause-btn" class="control-btn" title="Pause Playback">
                    <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 001 1h1a1 1 0 001-1V8a1 1 0 00-1-1H8zM12 7a1 1 0 00-1 1v4a1 1 0 001 1h1a1 1 0 001-1V8a1 1 0 00-1-1h-1z" clip-rule="evenodd"></path></svg>
                </button>
                <button id="slow-btn" class="control-btn" title="Slow Playback">
                    <svg id="turtle-icon" fill="#000000" version="1.2" baseProfile="tiny" id="_x31_" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 256 175" xml:space="preserve"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M185,29.7v0.2l15-12.6c-11.4-6.1-23.9-9.5-37.5-9.5s-26.2,3.4-37.1,9.3l15,12.6L185,29.7L185,29.7z M105.1,93.2 c-24.7,0-45,20.3-45,45v4.5l0,0c0.2,9.5,7.9,17,17.4,17s17.2-7.5,17.4-17l0,0v-4.5c0-5.7,4.5-10.1,10.1-10.1 c9.7,0,17.6-7.9,17.6-17.6S114.8,93.2,105.1,93.2z M221.9,92.8c-9.7,0-17.6,7.9-17.6,17.6v32.4l0,0c0.4,9.3,7.9,16.8,17.4,16.8 s17-7.5,17.4-16.8l0,0v-32.7C239.3,100.5,231.4,92.8,221.9,92.8z M252.7,101.9c0-4.3-1.4-8.5-3.4-12c-2.2,1.6-4.7,2.6-7.7,2.6 c4.1,4.9,6.5,11,6.5,17.6v5.5C251.3,111.8,252.7,107,252.7,101.9z M131.7,110.6c0,5.7-1.8,10.7-4.7,15c11.6,2.6,23.5,4.1,35.7,4.1 c11.4,0,22.1-1.2,32.7-3.4v-16c0-6.5,2.4-12.6,6.3-17h-76.5C129,98,131.7,103.9,131.7,110.6z M125,93.4L125,93.4c0.2,0,0-0.2,0-0.2 V93.4z M245.8,79.6c0-2.4-2-4.7-4.5-4.7h-0.6c-3.4-21.7-15.4-40.6-32.7-52.5l-17.6,14.8c9.7,11.4,16.4,24.1,20.3,37.9h-9.5 c-4.3-13-11.4-25.6-21.5-35.9h-32.9c-10.1,10.5-17,22.7-21.5,35.9h-9.5c3.9-13.4,10.3-26,19.9-36.9l-18.5-15.6 c-17,12.2-29.4,30.8-32.7,52.5h-1.2c-2.4,0-4.5,2-4.5,4.5c0,2.4,2,4.5,4.5,4.5h157.8C243.8,84.1,245.8,82,245.8,79.6z M81.6,89.5 c-4.9-0.6-8.9-4.7-8.9-9.9v-8.9c0-18.7-15-33.9-33.9-33.9c-18.7,0-33.9,15-33.9,33.9v8.9c0,4.9,4.1,8.9,8.9,8.9h24.5 c2.2,11.4,8.5,20.7,17.6,27.4C61.1,104.3,70.2,95.2,81.6,89.5z M24.2,64.4c-3,0-5.7-2.4-5.7-5.7c0-3,2.4-5.7,5.7-5.7 s5.7,2.4,5.7,5.7C29.8,61.9,27.4,64.4,24.2,64.4z"></path> </g></svg>
                </button>
            </div>
        </header>
        
        <main>
            <div class="lg-col-span-2 card">
                <div class="instructions text-center mb-6" style="color: var(--text-muted);">Click any highlighted word to hear it, see the translation, and add it to your list.</div>
                <div id="reading-pane" class="prose max-h-70vh overflow-y-auto pr-2"></div>
            </div>

            <div class="lg-col-span-1 card flex flex-col">
                <div class="flex-grow">
                    <h2 class="text-xl font-bold mb-4" style="color: var(--text-color);">My Word List</h2>
                    <div id="word-list" class="word-list space-y-2 max-h-45vh overflow-y-auto pr-2">
                         <p id="word-list-placeholder" style="color: var(--text-muted);">Words you save will appear here.</p>
                    </div>
                </div>
                <div class="sidebar-footer mt-4 pt-6" style="border-top: 1px solid var(--border-color);">
                    <h2 class="text-xl font-bold mb-4" style="color: var(--text-color);">Activities & Export</h2>
                    <div id="activities-section">
                        <div id="word-count-selector" class="hidden mb-4">
                            <label for="word-count" class="block text-sm font-medium mb-1" style="color: var(--text-muted);">Words for activity:</label>
                            <select id="word-count" name="word-count"></select>
                        </div>
                        <button id="quiz-btn" class="button button-primary" disabled>Multiple Choice Quiz</button>
                        <button id="matching-game-btn" class="button button-secondary" disabled>Memory Game</button>
                        <button id="export-btn" class="button button-slate flex items-center justify-center gap-3" disabled>
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                            <span>Copy Vocab</span>
                        </button>
                        <p id="activities-helper" class="text-sm text-center" style="color: var(--text-muted);">Add at least 4 words for activities.</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="translation-popup" class="hidden fixed z-50 card">
        <!-- Popup content is generated by JS -->
    </div>

    <div id="activity-modal" class="hidden fixed inset-0 z-40">
        <div id="main-content" class="h-full flex flex-col">
            <header id="activity-modal-header" class="flex justify-between items-center mb-6">
                <h2 id="activity-title" class="text-3xl font-bold">Activity</h2>
                <button id="close-activity-btn" class="text-4xl font-light" style="color: var(--text-muted);">&times;</button>
            </header>
            <div id="activity-content">
                <!-- Activity content (quiz, game) is generated by JS -->
            </div>
        </div>
    </div>
</div>
